<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>랜덤 문제 웹앱 · JSON 데이터</title>
  <style>
    :root {
      --bg:#0a0d12;         /* night sky */
      --card:#10151d;       /* cockpit panel */
      --panel:#0c1118;
      --muted:#9fb0c7;
      --text:#eef3fa;
      --accent:#1e90ff;     /* taxiway blue-ish */
      --ok:#22c55e;         /* green */
      --bad:#ef4444;        /* red */
      --amber:#f59e0b;      /* caution */
      --line:#1b2230;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji;
      background:
        linear-gradient(180deg, rgba(13,18,28,.9), rgba(8,12,20,.95)),
        radial-gradient(60vw 60vh at 80% -10%, rgba(30,144,255,.08), transparent 60%),
        radial-gradient(40vw 50vh at 10% 110%, rgba(34,197,94,.06), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1000px; margin:0 auto; padding:24px}
    header{position:relative; margin-bottom:14px; padding:16px 16px 16px 56px; background:var(--panel); border:1px solid var(--line); border-radius:14px}
    /* runway centerline */
    header:before{
      content:""; position:absolute; left:18px; top:12px; bottom:12px; width:10px;
      background: repeating-linear-gradient(
        to bottom,
        #e5e7eb 0 12px,
        transparent 12px 24px
      );
      border-radius:4px;
      filter:drop-shadow(0 0 6px rgba(229,231,235,.25));
    }
    h1{font-size:18px; margin:0}
    .subtitle{font-size:12px; color:var(--muted)}
    .tabs{display:flex; gap:8px; margin:12px 0}
    .tab{
      padding:8px 12px; border:1px solid var(--line); border-radius:10px;
      background:#0c121a; color:var(--muted); cursor:pointer
    }
    .tab.active{background:var(--card); color:var(--text); box-shadow:0 0 0 1px #203147 inset}
    .card{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:18px}
    .row{display:flex; gap:8px; align-items:center}
    .btn{padding:8px 12px; background:#0e1420; border:1px solid var(--line); border-radius:10px; color:var(--text); cursor:pointer}
    .btn.secondary{background:#0a0f18; color:var(--muted)}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .choices{display:grid; gap:10px}
    .choice{
      display:flex; gap:10px; align-items:center;
      border:1px solid var(--line); border-radius:12px; padding:12px;
      background:#0c1118;
      position:relative;
    }
    .choice.ok{ border-color:var(--ok); box-shadow:0 0 0 1px rgba(34,197,94,.25) inset; background:linear-gradient(0deg, rgba(34,197,94,.08), transparent 40%) }
    .choice.bad{ border-color:var(--bad); box-shadow:0 0 0 1px rgba(239,68,68,.25) inset; background:linear-gradient(0deg, rgba(239,68,68,.08), transparent 40%) }
    .choice.ok::before, .choice.bad::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:6px; border-top-left-radius:12px; border-bottom-left-radius:12px;
    }
    .choice.ok::before{ background:var(--ok) }
    .choice.bad::before{ background:var(--bad) }
    .muted{color:var(--muted)}
    .spacer{height:8px}
    .grid{display:grid; gap:12px}
    @media(min-width:720px){.grid-2{grid-template-columns:1fr 1fr}}
    code{background:#0a0f18; padding:2px 6px; border-radius:6px; border:1px solid var(--line)}
    .status{
      margin-top:6px; padding:8px 10px; border-radius:10px; font-size:13px;
      border:1px solid var(--line); background:#0a0f18; color:var(--muted)
    }
    .status.ok{ border-color:var(--ok); color:#d1fae5; background:rgba(34,197,94,.12) }
    .status.bad{ border-color:var(--bad); color:#fee2e2; background:rgba(239,68,68,.12) }
    /* taxiway blue lamps */
    .lamp-row{display:flex; gap:6px; margin-top:10px}
    .lamp{width:6px; height:6px; background:#1e90ff; border-radius:50%; filter:drop-shadow(0 0 6px rgba(30,144,255,.9))}
    .right{justify-content:flex-end}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>랜덤 문제 웹앱 · JSON 데이터</h1>
      <div class="subtitle">Aviation style • Randomized items • Wrong-only review • Local persistence</div>
      <div class="lamp-row"><div class="lamp"></div><div class="lamp"></div><div class="lamp"></div><div class="lamp"></div><div class="lamp"></div></div>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="quiz">퀴즈</button>
      <button class="tab" data-tab="wrong">오답노트</button>
      <button class="tab" data-tab="settings">설정</button>
    </div>

    <section id="quiz" class="card">
      <div class="row" style="justify-content:space-between; margin-bottom:10px">
        <div id="q-meta" class="muted">문제 0/0</div>
        <div class="row">
          <button class="btn secondary" id="btn-prev">이전</button>
          <button class="btn" id="btn-next">다음</button>
        </div>
      </div>
      <div id="q-question" style="white-space:pre-wrap; font-weight:600; line-height:1.5; margin-bottom:12px">데이터를 불러오세요.</div>
      <div id="q-choices" class="choices"></div>
      <div class="spacer"></div>
      <div class="row" style="gap:10px">
        <button class="btn" id="btn-submit">정답 확인</button>
        <button class="btn secondary" id="btn-reveal">해설 보기</button>
        <button class="btn ghost" id="btn-clear">선택 초기화</button>
      </div>
      <div id="q-status" class="status" style="display:none"></div>
      <div class="spacer"></div>
      <div id="q-explain" class="muted"></div>
      <div class="lamp-row right"><div class="lamp"></div><div class="lamp"></div><div class="lamp"></div></div>
    </section>

    <div class="spacer"></div>

    <section id="wrong" class="card" style="display:none">
      <div class="row" style="justify-content:space-between; margin-bottom:10px">
        <div>
          <div class="muted" style="margin-bottom:6px">틀린 문제만 재풀이</div>
          <div id="w-meta" class="muted">오답 0/0</div>
        </div>
        <div class="row" style="gap:8px">
          <button class="btn secondary" id="w-prev">이전</button>
          <button class="btn" id="w-next">다음</button>
          <button class="btn" id="btn-reset">오답 전부 초기화</button>
        </div>
      </div>
      <div id="w-question" style="white-space:pre-wrap; font-weight:600; line-height:1.5; margin-bottom:12px">오답이 없습니다.</div>
      <div id="w-choices" class="choices"></div>
      <div class="spacer"></div>
      <div class="row" style="gap:10px">
        <button class="btn" id="w-submit">정답 확인</button>
        <button class="btn secondary" id="w-reveal">해설 보기</button>
      </div>
      <div id="w-status" class="status" style="display:none"></div>
      <div class="spacer"></div>
      <div id="w-explain" class="muted"></div>
    </section>

    <div class="spacer"></div>

    <section id="settings" class="card" style="display:none">
      <div class="grid grid-2">
        <div>
          <div class="muted" style="margin-bottom:6px">데이터 파일</div>
          <div><code>questions.json</code></div>
        </div>
        <div>
          <div class="muted" style="margin-bottom:6px">동작</div>
          <div class="row" style="flex-wrap:wrap; gap:8px">
            <button class="btn" id="btn-reload">데이터 불러오기</button>
            <button class="btn" id="btn-shuffle">문제 섞기</button>
          </div>
        </div>
      </div>
      <div class="spacer"></div>
      <div class="muted">둘을 같은 폴더에 두고 GitHub Pages로 배포.</div>
    </section>
  </div>

  <script>
    // === 상태 ===
    let all = [];
    let order = [];
    let idx = 0;
    let wrongIds = JSON.parse(localStorage.getItem('wrongBank_v1') || '[]');
    let wOrder = []; let wIdx = 0;
    let picked = null; let revealed = false;
    let wPicked = null; let wRevealed = false;

    const $ = s => document.querySelector(s);
    function hash(s){ let h=0; for(let i=0;i<s.length;i++){ h=((h<<5)-h)+s.charCodeAt(i); h|=0;} return String(h>>>0); }
    function mkId(row){ return hash((row.question||'') + '|' + (row.choices||[]).join('|')); }
    function shuffle(a){ a=[...a]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
    function isCorrect(picked, row){
      const n = Number(row.correct);
      if(!Number.isNaN(n) && n>=1 && n<=4) return String(picked)===String(n);
      const t = String(row.correct).trim();
      const chosen = row.choices[Number(picked)-1]?.trim();
      return chosen === t;
    }

    async function load(){
      const res = await fetch('questions.json', { cache: 'no-store' });
      if(!res.ok) throw new Error('questions.json not found');
      const data = await res.json();
      data.forEach(o => o.id = mkId(o));
      all = data;
      order = all.map((_,i)=>i);
      idx = 0;
      renderQuiz();
      renderWrong();
    }

    // Tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const t = btn.dataset.tab;
        ['quiz','wrong','settings'].forEach(id=>{ document.getElementById(id).style.display = (id===t)?'block':'none'; });
      });
    });

    // Quiz render
    function renderQuiz(){
      const qMeta = $('#q-meta'); const qQ = $('#q-question'); const qC = $('#q-choices'); const qE = $('#q-explain'); const qS = $('#q-status');
      if(all.length===0){ qMeta.textContent='문제 0/0'; qQ.textContent='데이터가 없습니다.'; qC.innerHTML=''; qE.textContent=''; qS.style.display='none'; return; }
      const row = all[order[idx]];
      qMeta.textContent = `문제 ${idx+1} / ${order.length}`;
      qQ.textContent = row.question;
      qC.innerHTML = '';
      row.choices.forEach((c,i)=>{
        const el = document.createElement('label'); el.className = 'choice';
        el.innerHTML = `<input type="radio" name="q" value="${i+1}"> <div>${String.fromCharCode(65+i)}. ${c}</div>`;
        el.querySelector('input').onchange = (e)=>{ picked = e.target.value; paintChoices(); };
        qC.appendChild(el);
      });
      qE.textContent=''; qS.textContent=''; qS.style.display='none';
      picked=null; revealed=false; paintChoices();
    }
    function paintChoices(){
      if(all.length===0) return;
      const row = all[order[idx]];
      const nodes = [...document.querySelectorAll('#q-choices .choice')];
      nodes.forEach(el=>el.classList.remove('ok','bad'));
      if(revealed){
        nodes.forEach((el,i)=>{
          if(isCorrect(String(i+1), row)) el.classList.add('ok');
          else if(picked===String(i+1)) el.classList.add('bad');
        });
      }
    }

    // Wrong render
    function buildWrongOrder(){
      const set = new Set(wrongIds);
      const idxs = all.map((r,i)=> set.has(r.id)? i : -1).filter(i=>i>=0);
      wOrder = idxs; wIdx = 0;
    }
    function renderWrong(){
      buildWrongOrder();
      const meta = $('#w-meta'); const q = $('#w-question'); const c = $('#w-choices'); const e = $('#w-explain'); const s = $('#w-status');
      if(wOrder.length===0){ meta.textContent='오답 0/0'; q.textContent='오답이 없습니다.'; c.innerHTML=''; e.textContent=''; s.style.display='none'; return; }
      const row = all[wOrder[wIdx]];
      meta.textContent = `오답 ${wIdx+1} / ${wOrder.length}`;
      q.textContent = row.question;
      c.innerHTML='';
      row.choices.forEach((ch,i)=>{
        const el = document.createElement('label'); el.className='choice';
        el.innerHTML = `<input type="radio" name="w" value="${i+1}"> <div>${String.fromCharCode(65+i)}. ${ch}</div>`;
        el.querySelector('input').onchange = (e)=>{ wPicked = e.target.value; paintWrong(); };
        c.appendChild(el);
      });
      e.textContent=''; s.textContent=''; s.style.display='none';
      wPicked=null; wRevealed=false; paintWrong();
    }
    function paintWrong(){
      if(wOrder.length===0) return;
      const row = all[wOrder[wIdx]];
      const nodes = [...document.querySelectorAll('#w-choices .choice')];
      nodes.forEach(el=>el.classList.remove('ok','bad'));
      if(wRevealed){
        nodes.forEach((el,i)=>{
          if(isCorrect(String(i+1), row)) el.classList.add('ok');
          else if(wPicked===String(i+1)) el.classList.add('bad');
        });
      }
    }

    // Buttons
    $('#btn-prev').onclick = ()=>{ if(all.length===0) return; idx = (idx-1+order.length)%order.length; renderQuiz(); };
    $('#btn-next').onclick = ()=>{ if(all.length===0) return; idx = (idx+1)%order.length; renderQuiz(); };
    $('#btn-submit').onclick = ()=>{
      if(all.length===0 || !picked) return;
      revealed = true; paintChoices();
      const row = all[order[idx]];
      const ok = isCorrect(picked, row);
      const set = new Set(wrongIds);
      if(!ok) set.add(row.id); else set.delete(row.id);
      wrongIds = [...set]; localStorage.setItem('wrongBank_v1', JSON.stringify(wrongIds));
      const exp = (row.explanation||'').trim();
      $('#q-explain').textContent = exp? `해설: ${exp}` : '';
      const qS = $('#q-status');
      qS.textContent = ok ? '정답입니다.' : '오답입니다.';
      qS.className = 'status ' + (ok ? 'ok' : 'bad');
      qS.style.display = 'block';
      renderWrong();
    };
    $('#btn-reveal').onclick = ()=>{
      if(all.length===0) return;
      revealed=true; paintChoices();
      const row=all[order[idx]]; const exp=(row.explanation||'').trim();
      $('#q-explain').textContent = exp? `해설: ${exp}` : '';
    };
    $('#btn-clear').onclick = ()=>{
      picked=null; revealed=false; paintChoices();
      $('#q-explain').textContent=''; $('#q-status').style.display='none';
      document.querySelectorAll('#q-choices input[type=radio]').forEach(i=> i.checked=false);
    };

    $('#w-prev').onclick = ()=>{ if(wOrder.length===0) return; wIdx=(wIdx-1+wOrder.length)%wOrder.length; renderWrong(); };
    $('#w-next').onclick = ()=>{ if(wOrder.length===0) return; wIdx=(wIdx+1)%wOrder.length; renderWrong(); };
    $('#w-submit').onclick = ()=>{
      if(wOrder.length===0 || !wPicked) return;
      wRevealed=true; paintWrong();
      const row = all[wOrder[wIdx]]; const ok = isCorrect(wPicked,row);
      const s = $('#w-status');
      if(ok){
        wrongIds = wrongIds.filter(id=> id!==row.id);
        localStorage.setItem('wrongBank_v1', JSON.stringify(wrongIds));
        s.textContent='정답. 오답노트에서 제거됨.'; s.className='status ok'; s.style.display='block';
        renderWrong();
      } else {
        s.textContent='오답입니다.'; s.className='status bad'; s.style.display='block';
      }
      const exp = (row.explanation||'').trim(); $('#w-explain').textContent = exp? `해설: ${exp}` : '';
    };
    $('#w-reveal').onclick = ()=>{
      if(wOrder.length===0) return;
      wRevealed=true; paintWrong();
      const row=all[wOrder[wIdx]]; const exp=(row.explanation||'').trim();
      $('#w-explain').textContent = exp? `해설: ${exp}` : '';
    };

    $('#btn-reload').onclick = ()=> load();
    $('#btn-shuffle').onclick = ()=>{ order = shuffle(order); idx=0; renderQuiz(); };
    $('#btn-reset').onclick = ()=>{ wrongIds=[]; localStorage.setItem('wrongBank_v1','[]'); renderWrong(); };

    load().catch(err=>{
      console.error(err);
      alert('questions.json 로드 실패. 같은 폴더에 index.html과 questions.json이 있어야 합니다.');
    });
  </script>
</body>
</html>
